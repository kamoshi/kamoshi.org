---
import Ruby from "./Ruby.astro";
import { transform } from "../../utils/songs/parse";


interface Props {
  markdown?: boolean;
  song?: string;
}

const data = Astro.props.song || await Astro.slots.render('default');
const markdown = Astro.props.markdown;

const lyrics = transform(data, markdown);
const cols = lyrics.length ? Object.keys(lyrics[0]) : [];
---

<table class="c-lyrics">
  <tr>{cols.map(col => <th>{col}</th>)}</tr>
  {lyrics.map(row =>
    <tr>{cols.map(col =>
      <td>
        {row[col].map(line => <span><Ruby text={line}/></span><br/>)}
      </td>
    )}</tr>
  )}
</table>
